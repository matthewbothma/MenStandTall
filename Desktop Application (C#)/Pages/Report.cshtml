@* <!--
REPORT PAGE PURPOSE:
This page allows users (e.g. admin/staff) to upload or view reports about projects and activities.
It is useful for:
 - Tracking project progress and outcomes
 - Providing transparency and accountability to stakeholders
 - Helping management make informed decisions
 - Keeping all reports stored and organized in one place

BACKEND NOTE:   
 - Implement logic to fetch and display a list of submitted reports
 - Each report should include: title, description, date, category, and downloadable file link
 - Allow adding new reports and possibly editing/deleting existing ones
--> *@

@page
@model Wilproject.Pages.ReportModel
@{
    ViewData["Title"] = "Reports";
}

<link rel="stylesheet" href="~/css/reports.css" asp-append-version="true" />

<!-- Reports Header -->
<div class="reports-header">
    <div class="reports-header-content">
        <h1 class="reports-title"><i class="fas fa-chart-bar"></i> Reports</h1>
        <p class="reports-subtitle">Create, manage, and view comprehensive project reports</p>
    </div>
</div>

<!-- Report Statistics -->
<div class="report-stats">
    <div class="report-stat-card total">
        <div class="stat-number" id="total-reports">0</div>
        <div class="stat-label">Total Reports</div>
    </div>
    <div class="report-stat-card impact">
        <div class="stat-number" id="impact-reports">0</div>
        <div class="stat-label">Impact Reports</div>
    </div>
    <div class="report-stat-card finance">
        <div class="stat-number" id="finance-reports">0</div>
        <div class="stat-label">Financial Reports</div>
    </div>
    <div class="report-stat-card recent">
        <div class="stat-number" id="recent-reports">0</div>
        <div class="stat-label">This Month</div>
    </div>
</div>

<!-- Main Reports Container -->
<div class="reports-container">
    <!-- Create Report Card -->
    <div class="report-card">
        <div class="card-header-modern">
            <h3 class="card-title"><i class="fas fa-plus-circle"></i> Create New Report</h3>
            <p class="card-subtitle">Generate detailed reports for tracking and analysis</p>
        </div>

        <form id="reportForm">
            <!-- Report Title -->
            <div class="form-floating">
                <input type="text" id="Title" class="form-control" placeholder="Report Title" required />
                <label for="Title"><i class="fas fa-heading"></i> Report Title</label>
            </div>

            <!-- Description -->
            <div class="form-floating">
                <textarea id="Description" class="form-control" placeholder="Description" 
                          style="height: 120px;" required></textarea>
                <label for="Description"><i class="fas fa-align-left"></i> Description</label>
            </div>

            <!-- Date and Category Row -->
            <div class="row">
                <div class="col-md-6">
                    <div class="form-floating">
                        <input type="date" id="Date" class="form-control" required />
                        <label for="Date"><i class="fas fa-calendar"></i> Report Date</label>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-floating">
                        <select id="Category" class="form-control" required>
                            <option value="">-- Choose Category --</option>
                            <option value="Impact">Impact Report</option>
                            <option value="Finance">Financial Report</option>
                            <option value="Event">Event Report</option>
                            <option value="Progress">Progress Report</option>
                            <option value="Other">Other</option>
                        </select>
                        <label for="Category"><i class="fas fa-tags"></i> Category</label>
                    </div>
                </div>
            </div>

            <!-- Priority and Status Row -->
            <div class="row">
                <div class="col-md-6">
                    <div class="form-floating">
                        <select id="Priority" class="form-control">
                            <option value="Low">Low Priority</option>
                            <option value="Medium" selected>Medium Priority</option>
                            <option value="High">High Priority</option>
                        </select>
                        <label for="Priority"><i class="fas fa-exclamation-circle"></i> Priority</label>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-floating">
                        <select id="Status" class="form-control">
                            <option value="Draft">Draft</option>
                            <option value="Final" selected>Final</option>
                        </select>
                        <label for="Status"><i class="fas fa-flag"></i> Status</label>
                    </div>
                </div>
            </div>

            <!-- File Upload -->
            <div class="file-upload-wrapper">
                <label class="file-upload-label">
                    <i class="fas fa-file-pdf"></i> Upload Report Document (Optional)
                </label>
                <div class="file-upload" id="fileUploadArea">
                    <input type="file" id="File" accept=".pdf,.doc,.docx,.txt" />
                    <div class="file-upload-content">
                        <div class="file-upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="file-upload-text">Click to upload or drag and drop</div>
                        <div class="file-upload-hint">PDF, DOC, DOCX, TXT files up to 10MB</div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="d-flex justify-content-end gap-2">
                <button type="reset" class="btn-modern-report btn-clear">
                    <i class="fas fa-eraser"></i> Clear Form
                </button>
                <button type="button" class="btn-modern-report btn-draft" onclick="saveDraft()">
                    <i class="fas fa-save"></i> Save as Draft
                </button>
                <button type="submit" class="btn-modern-report btn-save">
                    <i class="fas fa-check"></i> Create Report
                </button>
            </div>
        </form>
    </div>

    <!-- Reports List Card -->
    <div class="report-card">
        <div class="card-header-modern">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h3 class="card-title"><i class="fas fa-folder-open"></i> My Reports</h3>
                    <p class="card-subtitle">View and manage your created reports</p>
                </div>
                <button class="btn-modern-report btn-secondary" onclick="refreshReports()" id="refreshReportsBtn">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
        </div>

        <div class="reports-list-header">
            <div class="search-filter-container">
                <div class="search-input">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search reports..." id="searchReports">
                </div>
                <select class="filter-select" id="categoryFilter">
                    <option value="all">All Categories</option>
                    <option value="impact">Impact</option>
                    <option value="finance">Finance</option>
                    <option value="event">Event</option>
                    <option value="progress">Progress</option>
                    <option value="other">Other</option>
                </select>
                <select class="filter-select" id="statusFilter">
                    <option value="all">All Status</option>
                    <option value="draft">Draft</option>
                    <option value="final">Final</option>
                </select>
            </div>
        </div>

        <!-- Loading State -->
        <div class="loading-reports" id="loadingReports">
            <div class="text-center py-4">
                <i class="fas fa-spinner fa-spin fa-2x text-muted mb-3"></i>
                <h5>Loading Reports...</h5>
                <p class="text-muted">Please wait while we fetch your reports.</p>
            </div>
        </div>

        <!-- Reports Grid -->
        <div class="reports-grid" id="reportsGrid" style="display: none;">
            <!-- Reports will be loaded here dynamically from Firebase -->
        </div>

        <!-- Empty State -->
        <div class="empty-reports" id="emptyReports" style="display: none;">
            <div class="text-center py-5">
                <div class="empty-icon">
                    <i class="fas fa-chart-bar"></i>
                </div>
                <h4>No Reports Yet</h4>
                <p>Get started by creating your first report to track progress and share insights!</p>
                <button class="btn-modern-report btn-save" onclick="focusReportForm()">
                    <i class="fas fa-plus"></i> Create Your First Report
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Report Modal -->
<div class="modal fade modal-modern" id="editReportModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-edit"></i>
                    Edit Report
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="editReportForm">
                    <input type="hidden" id="editReportId">
                    
                    <div class="form-floating">
                        <input type="text" id="editTitle" class="form-control" required />
                        <label for="editTitle"><i class="fas fa-heading"></i> Report Title</label>
                    </div>
                    
                    <div class="form-floating">
                        <textarea id="editDescription" class="form-control" style="height: 120px;" required></textarea>
                        <label for="editDescription"><i class="fas fa-align-left"></i> Description</label>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-floating">
                                <select id="editCategory" class="form-control" required>
                                    <option value="Impact">Impact Report</option>
                                    <option value="Finance">Financial Report</option>
                                    <option value="Event">Event Report</option>
                                    <option value="Progress">Progress Report</option>
                                    <option value="Other">Other</option>
                                </select>
                                <label for="editCategory"><i class="fas fa-tags"></i> Category</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-floating">
                                <select id="editStatus" class="form-control">
                                    <option value="Draft">Draft</option>
                                    <option value="Final">Final</option>
                                </select>
                                <label for="editStatus"><i class="fas fa-flag"></i> Status</label>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button type="button" class="btn-modern-report btn-save" onclick="updateReport()">
                    <i class="fas fa-save"></i> Update Report
                </button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        console.log('📊 Reports script starting...');
        
        var currentUser = null;
        var reports = [];
        var db = null;
        
        // Wait for global Firebase to be ready
        function waitForReportsFirebase(callback) {
            if (window.firebaseAuth && window.firebaseDB) {
                callback();
            } else {
                setTimeout(function() { waitForReportsFirebase(callback); }, 100);
            }
        }
        
        // Setup reports-specific functionality
        function setupReports() {
            console.log('📊 Setting up reports');
            
            if (!window.firebaseAuth || !window.firebaseDB) {
                console.error('❌ Firebase not available in reports');
                return;
            }
            
            db = window.firebaseDB;
            
            // Authentication check for reports
            window.firebaseAuth.onAuthStateChanged(function(user) {
                if (!user) {
                    console.log('❌ No user in reports, redirecting');
                    window.location.href = '/';
                } else {
                    currentUser = user;
                    console.log('✅ Reports user authenticated:', user.email);
                    setupReportHandlers();
                    loadReportsFromFirebase();
                }
            });
        }
        
        // Load reports from Firebase
        async function loadReportsFromFirebase() {
            if (!db || !currentUser) return;
            
            showLoadingState(true);
            
            try {
                const snapshot = await db.collection('reports')
                    .where('userId', '==', currentUser.uid)
                    .orderBy('createdAt', 'desc')
                    .get();
                
                reports = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));
                
                console.log('✅ Reports loaded:', reports.length);
                renderReports();
                updateReportStats();
                
            } catch (error) {
                console.error('Error loading reports:', error);
                showEmptyState();
            } finally {
                showLoadingState(false);
            }
        }
        
        // Setup report form handlers
        function setupReportHandlers() {
            const form = document.getElementById('reportForm');
            
            // Report form submission
            if (form) {
                form.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    await createReport();
                });
            }
            
            // Setup file upload
            setupFileUpload();
            
            // Setup filters and search
            setupFilters();
            
            // Set default date to today
            document.getElementById('Date').value = new Date().toISOString().split('T')[0];
        }
        
        // Create report
        async function createReport() {
            const title = document.getElementById('Title').value.trim();
            const description = document.getElementById('Description').value.trim();
            const date = document.getElementById('Date').value;
            const category = document.getElementById('Category').value;
            const priority = document.getElementById('Priority').value;
            const status = document.getElementById('Status').value;
            const file = document.getElementById('File').files[0];
            
            if (!title || !description || !date || !category) {
                showNotification('⚠️ Please fill in all required fields.', 'warning');
                return;
            }
            
            const reportData = {
                title: title,
                description: description,
                date: date,
                category: category,
                priority: priority,
                status: status,
                fileName: file ? file.name : null,
                fileSize: file ? file.size : null,
                userId: currentUser.uid,
                authorName: currentUser.displayName || currentUser.email,
                authorEmail: currentUser.email,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            try {
                const docRef = await db.collection('reports').add(reportData);
                console.log('✅ Report created with ID:', docRef.id);
                
                showNotification('✅ Report created successfully!', 'success');
                
                // Clear form
                document.getElementById('reportForm').reset();
                document.getElementById('Date').value = new Date().toISOString().split('T')[0];
                resetFileUpload();
                
                // Reload reports
                await loadReportsFromFirebase();
                
            } catch (error) {
                console.error('Error creating report:', error);
                showNotification('❌ Error creating report', 'error');
            }
        }
        
        // Save as draft
        async function saveDraft() {
            const title = document.getElementById('Title').value.trim();
            const description = document.getElementById('Description').value.trim();
            
            if (!title && !description) {
                showNotification('⚠️ Please add some content to save as draft.', 'warning');
                return;
            }
            
            // Set status to Draft and save
            document.getElementById('Status').value = 'Draft';
            await createReport();
        }
        
        // Update report
        async function updateReport() {
            const reportId = document.getElementById('editReportId').value;
            const title = document.getElementById('editTitle').value.trim();
            const description = document.getElementById('editDescription').value.trim();
            const category = document.getElementById('editCategory').value;
            const status = document.getElementById('editStatus').value;
            
            if (!title || !description || !reportId) {
                showNotification('⚠️ Please fill in all required fields.', 'warning');
                return;
            }
            
            const updateData = {
                title: title,
                description: description,
                category: category,
                status: status,
                updatedAt: new Date().toISOString()
            };
            
            try {
                await db.collection('reports').doc(reportId).update(updateData);
                console.log('✅ Report updated:', reportId);
                
                showNotification('✅ Report updated successfully!', 'success');
                
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('editReportModal'));
                modal.hide();
                
                // Reload reports
                await loadReportsFromFirebase();
                
            } catch (error) {
                console.error('Error updating report:', error);
                showNotification('❌ Error updating report', 'error');
            }
        }
        
        // Delete report
        async function deleteReport(reportId, reportTitle) {
            if (!confirm(`Are you sure you want to delete "${reportTitle}"?`)) {
                return;
            }
            
            try {
                await db.collection('reports').doc(reportId).delete();
                console.log('✅ Report deleted:', reportId);
                
                showNotification('✅ Report deleted successfully!', 'success');
                await loadReportsFromFirebase();
                
            } catch (error) {
                console.error('Error deleting report:', error);
                showNotification('❌ Error deleting report', 'error');
            }
        }
        
        // Edit report - populate modal
        function editReport(reportId) {
            const report = reports.find(r => r.id === reportId);
            if (!report) return;
            
            document.getElementById('editReportId').value = report.id;
            document.getElementById('editTitle').value = report.title;
            document.getElementById('editDescription').value = report.description;
            document.getElementById('editCategory').value = report.category;
            document.getElementById('editStatus').value = report.status;
            
            const modal = new bootstrap.Modal(document.getElementById('editReportModal'));
            modal.show();
        }
        
        // Render reports
        function renderReports() {
            const reportsGrid = document.getElementById('reportsGrid');
            
            if (reports.length === 0) {
                showEmptyState();
                return;
            }
            
            reportsGrid.innerHTML = '';
            reportsGrid.style.display = 'grid';
            document.getElementById('emptyReports').style.display = 'none';
            
            reports.forEach(report => {
                const reportDiv = createReportElement(report);
                reportsGrid.appendChild(reportDiv);
            });
            
            animateReports();
        }
        
        // Create report element
        function createReportElement(report) {
            const reportDiv = document.createElement('div');
            reportDiv.className = `report-item category-${report.category.toLowerCase()}`;
            reportDiv.setAttribute('data-category', report.category.toLowerCase());
            reportDiv.setAttribute('data-status', report.status.toLowerCase());
            
            const reportDate = new Date(report.date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
            
            const statusBadge = getStatusBadge(report.status);
            const priorityIndicator = report.priority === 'High' ? '<i class="fas fa-exclamation-triangle priority-high" title="High Priority"></i>' : '';
            
            reportDiv.innerHTML = `
                <div class="report-header">
                    <h6 class="report-title">${escapeHtml(report.title)} ${priorityIndicator}</h6>
                    <span class="report-category category-${report.category.toLowerCase()}">${report.category}</span>
                </div>
                <div class="report-description">${escapeHtml(report.description)}</div>
                <div class="report-meta">
                    <div class="report-info">
                        <div class="report-date">
                            <i class="fas fa-calendar"></i>
                            <span>${reportDate}</span>
                        </div>
                        <div class="report-status">
                            ${statusBadge}
                        </div>
                    </div>
                    <div class="report-actions">
                        <button class="report-action" onclick="editReport('${report.id}')" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="report-action" onclick="deleteReport('${report.id}', '${escapeHtml(report.title)}')" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                ${report.fileName ? 
                    `<button class="report-download" onclick="downloadReport('${report.id}')">
                        <i class="fas fa-download"></i>
                        Download ${report.fileName}
                    </button>` : 
                    `<div class="no-file">
                        <i class="fas fa-file-alt"></i>
                        No file attached
                    </div>`
                }
            `;
            
            return reportDiv;
        }
        
        // Utility functions
        function getStatusBadge(status) {
            const statusClass = status.toLowerCase();
            const icon = status === 'Draft' ? 'fas fa-edit' : 'fas fa-check';
            return `<span class="status-badge ${statusClass}"><i class="${icon}"></i> ${status}</span>`;
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Update report statistics
        function updateReportStats() {
            const impactReports = reports.filter(r => r.category === 'Impact').length;
            const financeReports = reports.filter(r => r.category === 'Finance').length;
            const thisMonth = new Date();
            thisMonth.setDate(1);
            const recentReports = reports.filter(r => new Date(r.createdAt) >= thisMonth).length;
            
            document.getElementById('total-reports').textContent = reports.length;
            document.getElementById('impact-reports').textContent = impactReports;
            document.getElementById('finance-reports').textContent = financeReports;
            document.getElementById('recent-reports').textContent = recentReports;
        }
        
        // Setup filters and search
        function setupFilters() {
            const searchInput = document.getElementById('searchReports');
            const categoryFilter = document.getElementById('categoryFilter');
            const statusFilter = document.getElementById('statusFilter');
            
            // Search functionality
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    filterReports();
                });
            }
            
            // Category filter
            if (categoryFilter) {
                categoryFilter.addEventListener('change', function() {
                    filterReports();
                });
            }
            
            // Status filter
            if (statusFilter) {
                statusFilter.addEventListener('change', function() {
                    filterReports();
                });
            }
        }
        
        // Filter reports
        function filterReports() {
            const searchTerm = document.getElementById('searchReports').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const reportItems = document.querySelectorAll('.report-item');
            
            reportItems.forEach(item => {
                const title = item.querySelector('.report-title').textContent.toLowerCase();
                const description = item.querySelector('.report-description').textContent.toLowerCase();
                const category = item.getAttribute('data-category');
                const status = item.getAttribute('data-status');
                
                const matchesSearch = title.includes(searchTerm) || description.includes(searchTerm);
                const matchesCategory = categoryFilter === 'all' || category === categoryFilter;
                const matchesStatus = statusFilter === 'all' || status === statusFilter;
                
                if (matchesSearch && matchesCategory && matchesStatus) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        // Setup file upload functionality
        function setupFileUpload() {
            const fileInput = document.getElementById('File');
            const uploadArea = document.getElementById('fileUploadArea');
            
            if (!fileInput || !uploadArea) return;
            
            // File input change
            fileInput.addEventListener('change', function() {
                handleFileSelect(this.files[0]);
            });
            
            // Drag and drop
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('drag-over');
            });
            
            uploadArea.addEventListener('dragleave', function() {
                this.classList.remove('drag-over');
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                const file = e.dataTransfer.files[0];
                if (file) {
                    fileInput.files = e.dataTransfer.files;
                    handleFileSelect(file);
                }
            });
        }
        
        // Handle file selection
        function handleFileSelect(file) {
            const uploadArea = document.getElementById('fileUploadArea');
            const uploadContent = uploadArea.querySelector('.file-upload-content');
            
            if (file) {
                uploadArea.classList.add('file-selected');
                uploadContent.innerHTML = `
                    <div class="file-upload-icon">
                        <i class="fas fa-file-check"></i>
                    </div>
                    <div class="file-upload-text">${file.name}</div>
                    <div class="file-upload-hint">File selected successfully (${(file.size / 1024 / 1024).toFixed(2)} MB)</div>
                `;
                console.log('📄 File selected:', file.name);
            }
        }
        
        // Reset file upload area
        function resetFileUpload() {
            const uploadArea = document.getElementById('fileUploadArea');
            const uploadContent = uploadArea.querySelector('.file-upload-content');
            const fileInput = document.getElementById('File');
            
            uploadArea.classList.remove('file-selected');
            fileInput.value = '';
            uploadContent.innerHTML = `
                <div class="file-upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <div class="file-upload-text">Click to upload or drag and drop</div>
                <div class="file-upload-hint">PDF, DOC, DOCX, TXT files up to 10MB</div>
            `;
        }
        
        // Download report (placeholder)
        function downloadReport(reportId) {
            const report = reports.find(r => r.id === reportId);
            if (report && report.fileName) {
                showNotification(`📥 Download functionality for "${report.fileName}" coming soon!`, 'info');
            } else {
                showNotification('❌ No file attached to this report', 'warning');
            }
        }
        
        // Focus report form
        function focusReportForm() {
            document.getElementById('Title').focus();
        }
        
        // Refresh reports
        async function refreshReports() {
            const refreshBtn = document.getElementById('refreshReportsBtn');
            const icon = refreshBtn.querySelector('i');
            
            icon.classList.add('fa-spin');
            refreshBtn.disabled = true;
            
            try {
                await loadReportsFromFirebase();
                showNotification('✅ Reports refreshed!', 'success');
            } catch (error) {
                showNotification('❌ Error refreshing reports', 'error');
            } finally {
                icon.classList.remove('fa-spin');
                refreshBtn.disabled = false;
            }
        }
        
        // UI state functions
        function showLoadingState(show) {
            const loading = document.getElementById('loadingReports');
            const reportsGrid = document.getElementById('reportsGrid');
            const emptyState = document.getElementById('emptyReports');
            
            if (show) {
                loading.style.display = 'block';
                reportsGrid.style.display = 'none';
                emptyState.style.display = 'none';
            } else {
                loading.style.display = 'none';
            }
        }
        
        function showEmptyState() {
            const loading = document.getElementById('loadingReports');
            const reportsGrid = document.getElementById('reportsGrid');
            const emptyState = document.getElementById('emptyReports');
            
            loading.style.display = 'none';
            reportsGrid.style.display = 'none';
            emptyState.style.display = 'block';
        }
        
        // Animate reports
        function animateReports() {
            const reportItems = document.querySelectorAll('.report-item');
            reportItems.forEach((item, index) => {
                item.style.opacity = '0';
                item.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    item.style.transition = 'all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
                    item.style.opacity = '1';
                    item.style.transform = 'translateY(0)';
                }, index * 100);
            });
        }
        
        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#10b981' : type === 'warning' ? '#f59e0b' : type === 'error' ? '#ef4444' : '#3b82f6'};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 9999;
                opacity: 0;
                transform: translateX(100%);
                transition: all 0.3s ease;
                max-width: 300px;
                font-weight: 500;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        // Initialize everything when Firebase is ready
        waitForReportsFirebase(function() {
            console.log('✅ Firebase ready for reports');
            setupReports();
            console.log('✅ Reports setup complete');
        });
        
        console.log('📊 Reports script loaded');
    </script>
}